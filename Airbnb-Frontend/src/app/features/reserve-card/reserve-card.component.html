<div class="border rounded-lg shadow p-6 bg-white">
  <h2 class="text-xl font-semibold mb-4">Reserve this property</h2>

  <!-- Date Selection -->
  <div class="grid grid-cols-2 border rounded-lg mb-4">
    <div class="p-3 border-r">
      <label for="check-in" class="block text-xs font-medium">CHECK-IN</label>
      <input
        type="date"
        id="check-in"
        [(ngModel)]="checkIn"
        [min]="minDate"
        (change)="onDateChange()"
        class="w-full outline-none text-gray-700 cursor-pointer"
        (click)="$event.stopPropagation()">
    </div>
    <div class="p-3">
      <label for="check-out" class="block text-xs font-medium">CHECKOUT</label>
      <input
        type="date"
        id="check-out"
        [(ngModel)]="checkOut"
        [min]="checkIn || minDate"
        (change)="onDateChange()"
        [disabled]="!checkIn"
        class="w-full outline-none text-gray-700 cursor-pointer"
        (click)="$event.stopPropagation()">
    </div>
  </div>

  <!-- Guest Selection -->
  <div class="relative">
    <div
      class="border rounded-lg p-3 mb-4 guest-trigger cursor-pointer"
      (click)="toggleGuestPopup($event)">
      <label class="block text-xs font-medium">GUESTS</label>
      <div class="text-gray-700">{{ getGuestsText() }}</div>
    </div>

    <!-- Guest Popup -->
    <div *ngIf="isGuestPopupOpen" class="guest-popup border rounded-lg p-4 bg-white">
      <!-- Adults -->
      <div class="flex items-center justify-between py-4 border-b">
        <div>
          <div class="font-medium">Adults</div>
          <div class="text-sm text-gray-500">Age 13+</div>
        </div>
        <div class="flex items-center gap-3">
          <button
            (click)="updateGuestCount('adults', -1, $event)"
            [disabled]="guests.adults <= 1"
            class="w-8 h-8 rounded-full border flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
            -
          </button>
          <span class="w-6 text-center">{{ guests.adults }}</span>
          <button
            (click)="updateGuestCount('adults', 1, $event)"
            [disabled]="getTotalGuests() >= maxGuests"
            class="w-8 h-8 rounded-full border flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
            +
          </button>
        </div>
      </div>

      <!-- Children -->
      <div class="flex items-center justify-between py-4 border-b">
        <div>
          <div class="font-medium">Children</div>
          <div class="text-sm text-gray-500">Ages 2â€“12</div>
        </div>
        <div class="flex items-center gap-3">
          <button
            (click)="updateGuestCount('children', -1, $event)"
            [disabled]="guests.children <= 0"
            class="w-8 h-8 rounded-full border flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
            -
          </button>
          <span class="w-6 text-center">{{ guests.children }}</span>
          <button
            (click)="updateGuestCount('children', 1, $event)"
            [disabled]="getTotalGuests() >= maxGuests"
            class="w-8 h-8 rounded-full border flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
            +
          </button>
        </div>
      </div>

      <!-- Infants -->
      <div class="flex items-center justify-between py-4 border-b">
        <div>
          <div class="font-medium">Infants</div>
          <div class="text-sm text-gray-500">Under 2</div>
        </div>
        <div class="flex items-center gap-3">
          <button
            (click)="updateGuestCount('infants', -1, $event)"
            [disabled]="guests.infants <= 0"
            class="w-8 h-8 rounded-full border flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
            -
          </button>
          <span class="w-6 text-center">{{ guests.infants }}</span>
          <button
            (click)="updateGuestCount('infants', 1, $event)"
            [disabled]="guests.infants >= 5"
            class="w-8 h-8 rounded-full border flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
            +
          </button>
        </div>
      </div>

      <!-- Pets -->
      <div class="flex items-center justify-between py-4">
        <div>
          <div class="font-medium">Pets</div>
          <div class="text-sm text-gray-500 underline cursor-pointer">Service animal?</div>
        </div>
        <div class="flex items-center gap-3">
          <button
            (click)="updateGuestCount('pets', -1, $event)"
            [disabled]="guests.pets <= 0"
            class="w-8 h-8 rounded-full border flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
            -
          </button>
          <span class="w-6 text-center">{{ guests.pets }}</span>
          <button
            (click)="updateGuestCount('pets', 1, $event)"
            [disabled]="guests.pets >= 5"
            class="w-8 h-8 rounded-full border flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
            +
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Reserve Button -->
  <button
    (click)="reserve()"
    [disabled]="!checkIn || !checkOut || paymentProcessing"
    class="w-full bg-rose-500 text-white py-3 rounded-lg font-medium hover:bg-rose-600 disabled:opacity-50 disabled:cursor-not-allowed">
    {{ paymentProcessing ? 'Processing...' : 'Reserve' }}
  </button>
</div>
